# CWatcher - Linux 系統監控平台開發計劃

## 專案概述
基於PRD需求，開發一個Linux系統監控平台，使用FastAPI後端 + React前端，採用TDD測試驅動開發方法。

## 開發階段規劃

### Phase 1: MVP核心功能 (P0優先級)
- SSH連接與伺服器管理
- 四大核心指標監控 (CPU/記憶體/磁碟/網路)
- 即時數據展示和基礎圖表
- 基本的Web UI介面

### Phase 2: 增強用戶體驗 (P1優先級)
- 系統詳細資訊展示
- 多時間範圍圖表
- 響應式設計優化
- 伺服器狀態管理

### Phase 3: 企業級功能 (P2優先級)
- 警報通知系統
- 歷史數據分析
- 用戶權限管理
- 數據匯出功能

---

## 🧪 測試部分 (Test-Driven Development)

### 1. 測試環境設置
- [ ] **1.1** 設置Python測試環境
  - [ ] 安裝pytest, pytest-asyncio, pytest-mock
  - [ ] 配置測試數據庫 (SQLite for testing)
  - [ ] 設置測試配置文件
  - [ ] 建立測試目錄結構 (`tests/unit/`, `tests/integration/`, `tests/e2e/`)

- [ ] **1.2** 設置前端測試環境
  - [ ] 安裝Jest, React Testing Library, MSW (Mock Service Worker)
  - [ ] 配置測試覆蓋率報告
  - [ ] 設置測試用的mock數據
  - [ ] 建立前端測試目錄結構

- [ ] **1.3** 設置集成測試環境
  - [ ] 配置Docker測試容器
  - [ ] 設置測試用的Linux虛擬機或容器
  - [ ] 建立SSH測試憑證
  - [ ] 配置CI/CD測試流水線

### 2. 後端API測試用例 (Phase 1)
- [ ] **2.1** SSH連接管理測試
  - [ ] 測試SSH連接建立成功
  - [ ] 測試SSH連接失敗處理
  - [ ] 測試SSH憑證驗證
  - [ ] 測試連接超時處理
  - [ ] 測試多個並發SSH連接

- [ ] **2.2** 系統指標收集測試
  - [ ] 測試CPU使用率數據收集
  - [ ] 測試記憶體使用率數據收集
  - [ ] 測試磁碟使用率數據收集
  - [ ] 測試網路流量數據收集
  - [ ] 測試數據解析和格式化

- [ ] **2.3** WebSocket即時通訊測試
  - [ ] 測試WebSocket連接建立
  - [ ] 測試即時數據推送
  - [ ] 測試連接斷開重連
  - [ ] 測試多客戶端廣播

- [ ] **2.4** 數據存儲測試
  - [ ] 測試時序數據存儲
  - [ ] 測試伺服器配置數據存儲
  - [ ] 測試數據查詢和檢索
  - [ ] 測試數據清理和歸檔

### 3. 前端組件測試用例 (Phase 1)
- [ ] **3.1** 伺服器管理組件測試
  - [ ] 測試伺服器列表顯示
  - [ ] 測試添加伺服器表單
  - [ ] 測試伺服器連接狀態顯示
  - [ ] 測試伺服器刪除功能

- [ ] **3.2** 監控指標組件測試
  - [ ] 測試CPU使用率圓形進度圖
  - [ ] 測試記憶體使用率顯示
  - [ ] 測試磁碟使用率顯示
  - [ ] 測試網路流量顯示

- [ ] **3.3** 圖表組件測試
  - [ ] 測試時間序列折線圖
  - [ ] 測試圖表數據更新
  - [ ] 測試圖表互動功能
  - [ ] 測試多時間範圍切換

- [ ] **3.4** WebSocket客戶端測試
  - [ ] 測試WebSocket連接
  - [ ] 測試即時數據接收
  - [ ] 測試連接錯誤處理
  - [ ] 測試自動重連機制

### 4. 端到端測試用例 (Phase 1)
- [ ] **4.1** 完整用戶流程測試
  - [ ] 測試用戶添加伺服器完整流程
  - [ ] 測試監控數據顯示完整流程
  - [ ] 測試多伺服器切換流程
  - [ ] 測試錯誤處理用戶體驗

- [ ] **4.2** 性能測試
  - [ ] 測試多伺服器並發監控
  - [ ] 測試大量數據處理性能
  - [ ] 測試前端渲染性能
  - [ ] 測試記憶體使用情況

---

## 🔧 後端部分 (FastAPI + Python)

### 1. 專案基礎設置
- [ ] **1.1** 專案結構建立
  - [ ] 建立FastAPI專案結構
  - [ ] 配置虛擬環境和依賴管理 (poetry/pipenv)
  - [ ] 設置環境變數配置 (.env, config.py)
  - [ ] 建立Docker配置文件

- [ ] **1.2** 核心依賴安裝
  - [ ] FastAPI, Uvicorn (ASGI server)
  - [ ] paramiko (SSH客戶端)
  - [ ] asyncio, aiofiles (異步處理)
  - [ ] pydantic (數據驗證)
  - [ ] SQLAlchemy (ORM)
  - [ ] alembic (數據庫遷移)

### 2. 數據庫設計與設置 (Phase 1)
- [ ] **2.1** 數據庫架構設計
  - [ ] 設計伺服器配置表 (servers)
  - [ ] 設計監控數據表 (metrics)
  - [ ] 設計連接狀態表 (connections)
  - [ ] 建立數據庫關係和索引

- [ ] **2.2** 數據庫實現
  - [ ] 實現SQLAlchemy模型
  - [ ] 建立數據庫遷移腳本
  - [ ] 實現數據庫連接池
  - [ ] 建立數據庫初始化腳本

### 3. SSH連接管理模組 (Phase 1)
- [ ] **3.1** SSH連接核心功能
  - [ ] 實現SSH連接建立 (`ssh_manager.py`)
  - [ ] 實現SSH憑證管理和加密存儲
  - [ ] 實現連接池管理
  - [ ] 實現連接狀態監控

- [ ] **3.2** SSH指令執行模組
  - [ ] 實現遠程指令執行 (`command_executor.py`)
  - [ ] 實現指令結果解析
  - [ ] 實現錯誤處理和重試機制
  - [ ] 實現指令執行超時控制

### 4. 系統指標收集模組 (Phase 1)
- [ ] **4.1** CPU監控實現
  - [ ] 實現CPU使用率收集 (使用 `top`, `/proc/stat`)
  - [ ] 實現CPU核心數和頻率獲取
  - [ ] 實現CPU負載平均值收集
  - [ ] 實現數據格式化和驗證

- [ ] **4.2** 記憶體監控實現
  - [ ] 實現記憶體使用率收集 (使用 `free`, `/proc/meminfo`)
  - [ ] 實現記憶體詳細資訊獲取
  - [ ] 實現Swap使用情況監控
  - [ ] 實現記憶體類型識別

- [ ] **4.3** 磁碟監控實現
  - [ ] 實現磁碟使用率收集 (使用 `df`)
  - [ ] 實現磁碟I/O監控 (使用 `iostat`)
  - [ ] 實現檔案系統資訊獲取
  - [ ] 實現磁碟健康狀態檢查

- [ ] **4.4** 網路監控實現
  - [ ] 實現網路流量收集 (`/proc/net/dev`)
  - [ ] 實現網路介面狀態監控
  - [ ] 實現網路連接統計
  - [ ] 實現網路速度計算

### 5. API路由設計 (Phase 1)
- [ ] **5.1** 伺服器管理API
  - [ ] `POST /api/servers` - 添加伺服器
  - [ ] `GET /api/servers` - 獲取伺服器列表
  - [ ] `PUT /api/servers/{id}` - 更新伺服器配置
  - [ ] `DELETE /api/servers/{id}` - 刪除伺服器
  - [ ] `POST /api/servers/{id}/test` - 測試連接

- [ ] **5.2** 監控數據API
  - [ ] `GET /api/servers/{id}/metrics/current` - 獲取即時數據
  - [ ] `GET /api/servers/{id}/metrics/history` - 獲取歷史數據
  - [ ] `GET /api/servers/{id}/system-info` - 獲取系統資訊
  - [ ] `GET /api/servers/{id}/status` - 獲取連接狀態

### 6. WebSocket即時通訊 (Phase 1)
- [ ] **6.1** WebSocket服務實現
  - [ ] 實現WebSocket連接管理
  - [ ] 實現客戶端訂閱機制
  - [ ] 實現即時數據廣播
  - [ ] 實現連接狀態管理

- [ ] **6.2** 數據推送服務
  - [ ] 實現定時數據收集任務
  - [ ] 實現數據變化檢測
  - [ ] 實現選擇性數據推送
  - [ ] 實現推送頻率控制

### 7. 後台任務調度 (Phase 1)
- [ ] **7.1** 任務調度器實現
  - [ ] 實現定時監控任務
  - [ ] 實現任務隊列管理
  - [ ] 實現任務失敗重試
  - [ ] 實現任務狀態監控

- [ ] **7.2** 數據清理任務
  - [ ] 實現歷史數據清理
  - [ ] 實現數據壓縮歸檔
  - [ ] 實現數據庫優化
  - [ ] 實現日誌清理

---

## 🎨 前端部分 (React + TypeScript)

### 1. 專案基礎設置
- [ ] **1.1** React專案初始化
  - [ ] 使用Create React App或Vite建立專案
  - [ ] 配置TypeScript支援
  - [ ] 安裝和配置Tailwind CSS
  - [ ] 設置ESLint和Prettier

- [ ] **1.2** 核心依賴安裝
  - [ ] React Router (路由管理)
  - [ ] Axios (HTTP客戶端)
  - [ ] Socket.io-client (WebSocket)
  - [ ] Chart.js + react-chartjs-2 (圖表)
  - [ ] React Hook Form (表單管理)
  - [ ] Zustand或Redux Toolkit (狀態管理)

### 2. 專案結構和配置 (Phase 1)
- [ ] **2.1** 目錄結構建立
  - [ ] 建立組件目錄 (`src/components/`)
  - [ ] 建立頁面目錄 (`src/pages/`)
  - [ ] 建立服務目錄 (`src/services/`)
  - [ ] 建立工具目錄 (`src/utils/`)
  - [ ] 建立類型定義 (`src/types/`)

- [ ] **2.2** 基礎配置
  - [ ] 配置API基礎URL和環境變數
  - [ ] 設置路由配置
  - [ ] 建立全局樣式和主題
  - [ ] 配置圖表預設樣式

### 3. 核心組件開發 (Phase 1)
- [ ] **3.1** 佈局組件
  - [ ] `Layout.tsx` - 主要佈局組件
  - [ ] `Sidebar.tsx` - 側邊欄伺服器列表
  - [ ] `Header.tsx` - 頂部導航欄
  - [ ] `Footer.tsx` - 底部資訊欄

- [ ] **3.2** 伺服器管理組件
  - [ ] `ServerList.tsx` - 伺服器列表顯示
  - [ ] `ServerCard.tsx` - 單個伺服器卡片
  - [ ] `AddServerModal.tsx` - 添加伺服器彈窗
  - [ ] `ServerStatus.tsx` - 伺服器狀態指示器

### 4. 監控指標組件 (Phase 1)
- [ ] **4.1** 指標卡片組件
  - [ ] `MetricCard.tsx` - 通用指標卡片
  - [ ] `CPUCard.tsx` - CPU使用率卡片
  - [ ] `MemoryCard.tsx` - 記憶體使用率卡片
  - [ ] `DiskCard.tsx` - 磁碟使用率卡片
  - [ ] `NetworkCard.tsx` - 網路流量卡片

- [ ] **4.2** 進度圓環組件
  - [ ] `CircularProgress.tsx` - 圓形進度條
  - [ ] `ProgressRing.tsx` - 帶動畫的進度環
  - [ ] `MetricGauge.tsx` - 儀表盤樣式指標

### 5. 圖表組件開發 (Phase 1)
- [ ] **5.1** 基礎圖表組件
  - [ ] `LineChart.tsx` - 時間序列折線圖
  - [ ] `AreaChart.tsx` - 面積圖
  - [ ] `BarChart.tsx` - 柱狀圖
  - [ ] `ChartContainer.tsx` - 圖表容器

- [ ] **5.2** 互動式圖表功能
  - [ ] 實現圖表縮放功能
  - [ ] 實現懸停顯示詳細數值
  - [ ] 實現時間範圍選擇器
  - [ ] 實現圖表數據更新動畫

### 6. 服務層開發 (Phase 1)
- [ ] **6.1** API服務
  - [ ] `serverService.ts` - 伺服器管理API
  - [ ] `metricsService.ts` - 監控數據API
  - [ ] `websocketService.ts` - WebSocket連接管理
  - [ ] `apiClient.ts` - HTTP客戶端配置

- [ ] **6.2** 數據處理服務
  - [ ] `dataFormatter.ts` - 數據格式化工具
  - [ ] `chartDataProcessor.ts` - 圖表數據處理
  - [ ] `metricsCalculator.ts` - 指標計算工具
  - [ ] `timeRangeUtils.ts` - 時間範圍處理

### 7. 狀態管理 (Phase 1)
- [ ] **7.1** 全局狀態設計
  - [ ] 伺服器列表狀態
  - [ ] 當前選中伺服器狀態
  - [ ] 監控數據狀態
  - [ ] WebSocket連接狀態

- [ ] **7.2** 狀態管理實現
  - [ ] `useServerStore.ts` - 伺服器狀態管理
  - [ ] `useMetricsStore.ts` - 監控數據狀態管理
  - [ ] `useWebSocketStore.ts` - WebSocket狀態管理
  - [ ] `useUIStore.ts` - UI狀態管理

### 8. 頁面組件開發 (Phase 1)
- [ ] **8.1** 主要頁面
  - [ ] `Dashboard.tsx` - 主儀表板頁面
  - [ ] `ServerDetail.tsx` - 伺服器詳情頁面
  - [ ] `Settings.tsx` - 設置頁面
  - [ ] `NotFound.tsx` - 404錯誤頁面

- [ ] **8.2** 響應式設計
  - [ ] 實現桌面端佈局
  - [ ] 實現平板端適配
  - [ ] 實現手機端適配
  - [ ] 實現暗色主題

---

## 📋 開發里程碑

### Milestone 1: 基礎架構 (Week 1-2)
- [ ] 完成測試環境設置
- [ ] 完成後端專案基礎設置
- [ ] 完成前端專案基礎設置
- [ ] 完成數據庫設計和基礎模型

### Milestone 2: 核心功能 (Week 3-4)
- [ ] 完成SSH連接管理
- [ ] 完成基礎監控數據收集
- [ ] 完成基礎API實現
- [ ] 完成基礎前端組件

### Milestone 3: 數據展示 (Week 5-6)
- [ ] 完成WebSocket即時通訊
- [ ] 完成圖表組件實現
- [ ] 完成監控指標顯示
- [ ] 完成基礎用戶界面

### Milestone 4: 集成測試 (Week 7-8)
- [ ] 完成端到端功能測試
- [ ] 完成性能優化
- [ ] 完成錯誤處理
- [ ] 完成文檔編寫

---

## 🚀 部署和運維

### 1. 開發環境部署
- [ ] **1.1** Docker開發環境
  - [ ] 建立後端Docker配置
  - [ ] 建立前端Docker配置
  - [ ] 建立數據庫Docker配置
  - [ ] 建立Docker Compose配置

### 2. 生產環境準備
- [ ] **2.1** 生產環境配置
  - [ ] 配置Nginx反向代理
  - [ ] 配置HTTPS證書
  - [ ] 配置環境變數管理
  - [ ] 配置日誌管理

### 3. 監控和維護
- [ ] **3.1** 系統監控
  - [ ] 配置應用性能監控
  - [ ] 配置錯誤追蹤
  - [ ] 配置健康檢查
  - [ ] 配置備份策略

---

## 📚 文檔和資源

### 1. 技術文檔
- [ ] API文檔 (使用FastAPI自動生成)
- [ ] 組件文檔 (使用Storybook)
- [ ] 部署文檔
- [ ] 開發者指南

### 2. 用戶文檔
- [ ] 用戶使用手冊
- [ ] 安裝配置指南
- [ ] 故障排除指南
- [ ] FAQ常見問題

---

## ⚡ 快速開始檢查清單

### 第一天任務
- [ ] 閱讀完整PRD文檔
- [ ] 設置開發環境 (Python + Node.js)
- [ ] 建立Git倉庫和分支策略
- [ ] 完成測試環境基礎設置

### 第一週目標
- [ ] 完成後端專案結構
- [ ] 完成前端專案結構
- [ ] 實現基礎SSH連接功能
- [ ] 實現基礎API框架

### 第一個月目標
- [ ] 完成MVP核心功能
- [ ] 完成基礎測試覆蓋
- [ ] 完成基礎部署配置
- [ ] 完成基礎文檔

---

*注意：此TODO列表按照TDD原則設計，建議先寫測試再實現功能。每個功能點都應該有對應的測試用例，確保代碼質量和可維護性。*